{% extends "base.html" %}
{% load static %}
{% load shop_extras %}

{% block content %}

<div class="container-fluid shop-container">
    <div class="shop-container-opacity"></div>
    <div class="row filter-bar justify-content-center">
        <div class="filter-bar-opacity"></div>
        <div class="col-10 my-4">
            <div class="row mb-3">
                <div class="col d-flex justify-content-center">
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="typeDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if types_count == 1 and types_filtered %}
                            {% for key, value in types.items %}
                            {{ key }} ({{ value }})
                            {% endfor %}
                            {% else %}
                            Whisky Type ({{ types_count }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="typeDropdown">
                            {% if types_count == 1 and types_filtered %}
                            <li class="dropdown-item" id="typeClear">Clear 'Whisky Type' filter</li>
                            {% else %}
                            {% for key, value in types.items|dictsort:0 %}
                            <li class="dropdown-item type-item">
                                {{ key }} ({{ value }})
                                <input type="hidden" class="type-name" value="{{ type_names|lookup:key }}">
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="brandDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if brands_count == 1 and brands_filtered %}
                            {% for key, value in brands.items %}
                            {{ key }} ({{ value }})
                            {% endfor %}
                            {% else %}
                            Brand ({{ brands_count }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="brandDropdown">
                            {% if brands_count == 1 and brands_filtered %}
                            <li class="dropdown-item" id="brandClear">Clear 'Brand' filter</li>
                            {% else %}
                            {% for key, value in brands.items|dictsort:0 %}
                            <li class="dropdown-item brand-item">
                                {{ key }} ({{ value }})
                                <input type="hidden" class="brand-name" value="{{ brand_names|lookup:key }}">
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="countryDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if countries_count == 1 and countries_filtered %}
                            {% for key, value in countries.items %}
                            {{ key }} ({{ value }})
                            {% endfor %}
                            {% else %}
                            Country ({{ countries_count }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="countryDropdown">
                            {% if countries_count == 1 and countries_filtered %}
                            <li class="dropdown-item" id="countryClear">Clear 'Country' filter</li>
                            {% else %}
                            {% for key, value in countries.items|dictsort:0 %}
                            <li class="dropdown-item country-item">
                                {{ key }} ({{ value }})
                                <input type="hidden" class="country-name" value="{{ country_names|lookup:key }}">
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="regionDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if regions_count == 1 and regions_filtered %}
                            {% for key, value in regions.items %}
                            {{ key }} ({{ value }})
                            {% endfor %}
                            {% else %}
                            Region ({{ regions_count }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="regionDropdown">
                            {% if regions_count == 1 and regions_filtered %}
                            <li class="dropdown-item" id="regionClear">Clear 'Region' filter</li>
                            {% else %}
                            {% for key, value in regions.items|dictsort:0 %}
                            <li class="dropdown-item region-item">
                                {{ key }} ({{ value }})
                                <input type="hidden" class="region-name" value="{{ region_names|lookup:key }}">
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col d-flex justify-content-center">
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="priceDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if prices_filtered %}
                            Price: £{{ price_min }} to £{{ price_max }}
                            {% else %}
                            Price: £{{ price_min_initial }} to £{{ price_max_initial }}
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu price-dropdown" aria-labelledby="priceDropdown">
                            <li class="text-center">
                                <label for="minPrice" class="min-price-label">Min: </label>
                                <input type="number" name="minPrice" class="min-price" min="{{ price_min_initial }}"
                                    max="{{ price_max_initial|subtract:1 }}" value="{{ price_min_initial }}">
                                <label for="maxPrice" class="max-price-label">Max: </label>
                                <input type="number" name="maxPrice" class="max-price"
                                    min="{{ price_min_initial|add:1 }}" max="{{ price_max_initial }}"
                                    value="{{ price_max_initial }}">
                            </li>
                            <li class="dropdown-item pt-2" id="priceApply">Apply 'Price' filter</li>
                            {% if prices_filtered %}
                            <li class="dropdown-item" id="priceClear">Clear 'Price' filter</li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="ageDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if ages_count == 1 and ages_filtered %}
                            {% for key, value in ages.items %}
                            {{ key }} Years Old ({{ value }})
                            {% endfor %}
                            {% else %}
                            Age ({{ ages_count|subtract:1 }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="ageDropdown">
                            {% if ages_count == 1 and ages_filtered %}
                            <li class="dropdown-item" id="ageClear">Clear 'Age' filter</li>
                            {% else %}
                            {% for key, value in ages.items|dictsortreversed:0 %}
                            {% if key|is_numeric %}
                            <li class="dropdown-item age-item"><span class="age-name">{{ key }}</span> Years Old ({{ value }})
                            </li>
                            {% endif %}
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="flavourDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            {% if flavours_count == 1 and flavours_filtered %}
                            {% for key, value in flavours.items %}
                            {{ key }} ({{ value }})
                            {% endfor %}
                            {% else %}
                            Flavour ({{ flavours_count }})
                            {% endif %}
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="flavourDropdown">
                            {% if flavours_count == 1 and flavours_filtered %}
                            <li class="dropdown-item" id="flavourClear">Clear 'Flavour' filter</li>
                            {% else %}
                            {% for key, value in flavours.items|dictsort:0 %}
                            <li class="dropdown-item flavour-item">
                                {{ key }} ({{ value }})
                                <input type="hidden" class="flavour-name" value="{{ flavour_names|lookup:key }}">
                            </li>
                            {% endfor %}
                            {% endif %}
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn filter-btn dropdown-toggle" type="button" id="sortDropdown"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Sort By
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-sm-11 col-md-10">
            <div class="row justify-content-evenly mt-5">
                {% for product in products %}
                <div class="col-10 col-sm-6 col-lg-4 col-xl-3 mb-5">
                    <div class="card h-100 mx-sm-2 mx-md-3 p-3 product-card box-shadow-custom">
                        <img src="{{ product.image.url }}" class="card-img-top img-fluid"
                            alt="{{ product.brand.friendly_name }}: {{ product.name }}">
                        <div class="card-body">
                            <h5 class="card-title text-center product-card-title">{{ product.brand.friendly_name }}:
                                {{ product.name }}
                            </h5>
                            <div class="d-flex justify-content-between my-3">
                                <p class="d-inline my-0 ms-2">
                                    <i class="fas fa-star"></i>
                                    {{ product.rating }}
                                </p>
                                <p class="d-inline my-0 me-2">
                                    £{{ product.price }}
                                </p>
                            </div>
                            <div class="d-flex justify-content-center">
                                <a href="#" class="btn btn-custom box-shadow-custom w-100">Add to cart</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block postloadjs %}

<script src="{% static 'shop/js/shop.js' %}"></script>

{% endblock %}